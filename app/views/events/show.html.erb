<div class="wrapper collapsing-wrapper">
  <%# SIDEBAR %>
  <div class="collapsing-sidebar" id="sidebar">
    <%= render :partial => "content_providers/partials/content_provider_info", :locals => {:content_provider => @event.content_provider} %>
    <%= render partial: "nodes/partials/associated_node_info", locals: { associated_nodes: @event.associated_nodes } %>
    <%= render(partial: 'users/partials/user_info', locals: { user: @event.user }) if current_user.try(:is_admin?) %>
  </div>
  <div id="content">
    <div class="row">
      <%= star_button(@event) if user_signed_in? %>

      <div class="content_action">
        <%= link_to t('.back', :default => t("helpers.links.back")),
                    :back, :class => 'btn btn-info'  %>
        <%= render partial: 'common/identifiers_dot_org_button', locals: { resource: @event } if TeSS::Config.identifiers_prefix %>
        <% if @event.start && @event.end %>
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Add to calendar <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li>
                  <%= link_to google_calendar_export_url(@event) do %>
                      <i class="fa fa-google"></i> Google Calendar
                  <% end %>
                </li>
                <li>
                  <%= link_to event_path(@event, format: :ics) do %>
                      <i class="<%= icon_class_for_model('events') -%>"></i> Save event (.ics file)
                  <% end %>
                </li>
              </ul>
            </div>
        <% end %>
        <% if !current_user.nil? and policy(@event).update? %>
            <%= link_to 'Edit', edit_event_path(@event), :class=>"btn btn-primary" %>
        <% end %>
        <% if !current_user.nil? and policy(@event).destroy? %>
            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        event_path(@event),
                        :method => 'delete',
                        :data => { :confirm => t('.confirm', :default => t("helpers.l inks.confirm", :default => 'Are you sure?')) },
                        :class => 'btn btn-danger' %>
        <% end %>
        <a href="<%= @event.url %>" target="_blank" class="btn btn-success"><span class="fa fa-external-link"></span> View event</a>
      </div>
    </div>

    <div class="row">
      <ul class="nav nav-tabs">
        <%= tab('Event', icon_class_for_model('events'), 'home', active: true) %>

        <%= tab('Activity log', icon_class_for_model('activity_logs'), 'activity_log',
                disabled: { check: @event.activities.none?, message: 'No activities recorded' }) %>
      </ul>

      <div class="tab-content">
        <div id="home" class="tab-pane fade in active">
          <%= render 'info', event: @event %>
        </div>
        <div id="activity_log" class="tab-pane fade" data-activity-path="<%= event_activities_path(@event) -%>">
          <%= image_tag('ajax-loader.gif') %>
        </div>
      </div>
    </div>
  </div>
</div>
